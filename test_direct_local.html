<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>×‘×“×™×§×ª ×—×™×‘×•×¨ ×™×©×™×¨ ××§×•××™</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a67d8;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ×‘×“×™×§×ª ×—×™×‘×•×¨ ×™×©×™×¨ ××§×•××™</h1>
    
    <div class="test-section">
        <h2>1. ×‘×“×™×§×ª ×¡×‘×™×‘×”</h2>
        <button onclick="checkEnvironment()">×‘×“×•×§ ×¡×‘×™×‘×”</button>
        <div id="envResult"></div>
    </div>
    
    <div class="test-section">
        <h2>2. ×‘×“×™×§×ª ×—×™×‘×•×¨ ×™×©×™×¨ ×œ×©×¨×ª ×”×—× ×™×•×Ÿ</h2>
        <button onclick="testDirectConnection()">×‘×“×•×§ ×—×™×‘×•×¨ ×™×©×™×¨</button>
        <div id="directResult"></div>
    </div>
    
    <div class="test-section">
        <h2>3. ×§×‘×œ×ª ×¨×©×™××ª ×—×‘×¨×•×ª</h2>
        <button onclick="getContracts()">×§×‘×œ ×—×‘×¨×•×ª</button>
        <div id="contractsResult"></div>
    </div>

    <script>
        function checkEnvironment() {
            const isLocal = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1';
            
            const result = document.getElementById('envResult');
            
            if (isLocal) {
                result.innerHTML = `
                    <div class="result success">
                        âœ… ×¡×‘×™×‘×” ××§×•××™×ª ×–×•×”×ª×”!<br>
                        Hostname: ${window.location.hostname}<br>
                        ×××•×¨ ×œ×”×ª×—×‘×¨ ×™×©×™×¨×•×ª ×œ: 10.35.240.100:8443
                    </div>
                `;
            } else {
                result.innerHTML = `
                    <div class="result info">
                        â˜ï¸ ×¡×‘×™×‘×ª Production<br>
                        Hostname: ${window.location.hostname}<br>
                        ×××•×¨ ×œ×”×©×ª××© ×‘-proxy
                    </div>
                `;
            }
        }
        
        async function testDirectConnection() {
            const result = document.getElementById('directResult');
            result.innerHTML = '<div class="result info">×‘×•×“×§ ×—×™×‘×•×¨...</div>';
            
            try {
                const url = 'https://10.35.240.100:8443/CustomerMediaWebService/contracts';
                const headers = {
                    'Authorization': 'Basic ' + btoa('2022:2022'),
                    'Accept': 'application/xml'
                };
                
                console.log('Testing direct connection to:', url);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: headers
                });
                
                result.innerHTML = `
                    <div class="result ${response.ok ? 'success' : 'error'}">
                        Status: ${response.status}<br>
                        ${response.ok ? 'âœ… ×—×™×‘×•×¨ ×™×©×™×¨ ×¢×•×‘×“!' : 'âŒ ×‘×¢×™×” ×‘×—×™×‘×•×¨'}
                    </div>
                `;
                
                if (response.ok) {
                    const text = await response.text();
                    console.log('Response:', text.substring(0, 200));
                }
                
            } catch (error) {
                result.innerHTML = `
                    <div class="result error">
                        âŒ ×©×’×™××”: ${error.message}<br>
                        <small>×× ×™×© ×©×’×™××ª CORS ××• SSL, ×–×” × ×•×¨××œ×™ ×‘×“×¤×“×¤×Ÿ</small>
                    </div>
                `;
            }
        }
        
        async function getContracts() {
            const result = document.getElementById('contractsResult');
            result.innerHTML = '<div class="result info">×˜×•×¢×Ÿ ×—×‘×¨×•×ª...</div>';
            
            try {
                // Import the actual API class
                const script = document.createElement('script');
                script.src = '/static/js/parking-api-live.js?v=' + Date.now();
                document.head.appendChild(script);
                
                script.onload = async () => {
                    const api = new ParkingAPIXML();
                    
                    // Check what mode we're in
                    console.log('API Config:', api.config);
                    
                    result.innerHTML = `
                        <div class="result info">
                            Mode: ${api.config.useProxy ? 'PROXY' : 'DIRECT'}<br>
                            BaseURL: ${api.config.baseUrl}
                        </div>
                    `;
                    
                    // Try to get contracts
                    const contractsResult = await api.getContracts();
                    
                    if (contractsResult.success) {
                        result.innerHTML += `
                            <div class="result success">
                                âœ… ×§×™×‘×œ× ×• ${contractsResult.data.length || 0} ×—×‘×¨×•×ª!
                            </div>
                        `;
                    } else {
                        result.innerHTML += `
                            <div class="result error">
                                âŒ ×©×’×™××”: ${contractsResult.error}
                            </div>
                        `;
                    }
                };
            } catch (error) {
                result.innerHTML = `
                    <div class="result error">
                        âŒ ×©×’×™××”: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>

