<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <title>×‘×“×™×§×” ×™×©×™×¨×” ×©×œ ×”-Endpoint</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 8px; max-width: 900px; margin: 0 auto; }
        .test { margin: 10px 0; padding: 15px; border: 2px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #28a745; }
        .error { background: #f8d7da; border-color: #dc3545; }
        .warning { background: #fff3cd; border-color: #ffc107; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ×‘×“×™×§×” ×™×©×™×¨×” ×©×œ ×”-Endpoint</h1>
        
        <button onclick="runAllTests()">×”×¨×¥ ××ª ×›×œ ×”×‘×“×™×§×•×ª</button>
        
        <div id="results"></div>
    </div>

    <script>
        const BASE_URL = 'https://s-b-parking-reports.onrender.com';
        
        async function runAllTests() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            // Test 1: Check version
            resultsDiv.innerHTML += '<div class="test">â³ ×‘×•×“×§ ×’×¨×¡×”...</div>';
            try {
                const versionRes = await fetch(`${BASE_URL}/api/status`);
                const versionData = await versionRes.json();
                resultsDiv.innerHTML += `
                    <div class="test ${versionData.version === '2.0.6' ? 'success' : 'warning'}">
                        <h3>×‘×“×™×§×ª ×’×¨×¡×”:</h3>
                        <pre>${JSON.stringify(versionData, null, 2)}</pre>
                    </div>
                `;
            } catch (e) {
                resultsDiv.innerHTML += `<div class="test error">âŒ ×©×’×™××” ×‘×‘×“×™×§×ª ×’×¨×¡×”: ${e.message}</div>`;
            }
            
            // Test 2: GET request to proxy
            resultsDiv.innerHTML += '<div class="test">â³ ×‘×•×“×§ GET ×œ-proxy...</div>';
            try {
                const getRes = await fetch(`${BASE_URL}/api/company-manager/proxy`);
                const getText = await getRes.text();
                resultsDiv.innerHTML += `
                    <div class="test ${getRes.ok ? 'success' : 'error'}">
                        <h3>GET /api/company-manager/proxy:</h3>
                        <p>Status: ${getRes.status} ${getRes.statusText}</p>
                        <p>Headers: ${getRes.headers.get('content-type')}</p>
                        <pre>${getText}</pre>
                    </div>
                `;
            } catch (e) {
                resultsDiv.innerHTML += `<div class="test error">âŒ ×©×’×™××” ×‘-GET: ${e.message}</div>`;
            }
            
            // Test 3: OPTIONS request
            resultsDiv.innerHTML += '<div class="test">â³ ×‘×•×“×§ OPTIONS...</div>';
            try {
                const optRes = await fetch(`${BASE_URL}/api/company-manager/proxy`, {
                    method: 'OPTIONS'
                });
                resultsDiv.innerHTML += `
                    <div class="test ${optRes.ok ? 'success' : 'error'}">
                        <h3>OPTIONS /api/company-manager/proxy:</h3>
                        <p>Status: ${optRes.status}</p>
                        <p>CORS Headers:</p>
                        <ul>
                            <li>Allow-Origin: ${optRes.headers.get('access-control-allow-origin')}</li>
                            <li>Allow-Methods: ${optRes.headers.get('access-control-allow-methods')}</li>
                            <li>Allow-Headers: ${optRes.headers.get('access-control-allow-headers')}</li>
                        </ul>
                    </div>
                `;
            } catch (e) {
                resultsDiv.innerHTML += `<div class="test error">âŒ ×©×’×™××” ×‘-OPTIONS: ${e.message}</div>`;
            }
            
            // Test 4: POST request
            resultsDiv.innerHTML += '<div class="test">â³ ×‘×•×“×§ POST...</div>';
            try {
                const postRes = await fetch(`${BASE_URL}/api/company-manager/proxy`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({test: true}),
                    credentials: 'include'
                });
                const postText = await postRes.text();
                resultsDiv.innerHTML += `
                    <div class="test ${postRes.status === 401 ? 'warning' : postRes.ok ? 'success' : 'error'}">
                        <h3>POST /api/company-manager/proxy:</h3>
                        <p>Status: ${postRes.status}</p>
                        <pre>${postText}</pre>
                        ${postRes.status === 401 ? '<p>âœ… ×”-endpoint ×§×™×™×! (401 = ×¦×¨×™×š ×œ×”×™×•×ª ××—×•×‘×¨)</p>' : ''}
                        ${postRes.status === 404 ? '<p>âŒ ×”-endpoint ×œ× ×§×™×™×!</p>' : ''}
                    </div>
                `;
            } catch (e) {
                resultsDiv.innerHTML += `<div class="test error">âŒ ×©×’×™××” ×‘-POST: ${e.message}</div>`;
            }
            
            // Test 5: Check other endpoints
            resultsDiv.innerHTML += '<div class="test">â³ ×‘×•×“×§ endpoints ××—×¨×™×...</div>';
            const endpoints = [
                '/api/company-manager/get-parkings',
                '/api/company-manager/get-subscribers'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const res = await fetch(`${BASE_URL}${endpoint}`);
                    resultsDiv.innerHTML += `
                        <div class="test ${res.status === 401 ? 'success' : 'warning'}">
                            <p>${endpoint}: Status ${res.status}</p>
                        </div>
                    `;
                } catch (e) {
                    resultsDiv.innerHTML += `<div class="test error">âŒ ${endpoint}: ${e.message}</div>`;
                }
            }
            
            // Final analysis
            resultsDiv.innerHTML += `
                <div class="test warning">
                    <h3>ğŸ“Š × ×™×ª×•×—:</h3>
                    <p>×× /api/company-manager/proxy ××—×–×™×¨ 404 ××‘×œ endpoints ××—×¨×™× ×¢×•×‘×“×™×,
                    ×™×™×ª×›×Ÿ ×©:</p>
                    <ul>
                        <li>×”×§×•×‘×¥ appV3.py ×¢×•×“×›×Ÿ ×—×œ×§×™×ª</li>
                        <li>×™×© ×‘×¢×™×” ×‘×¡×“×¨ ×©×œ ×”-routes</li>
                        <li>×™×© ×‘×¢×™×” ×¢× Flask routing</li>
                    </ul>
                </div>
            `;
        }
        
        // Auto-run on load
        window.onload = runAllTests;
    </script>
</body>
</html>
